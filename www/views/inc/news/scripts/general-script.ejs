
<%if(flagShowUpdatePopupSocial){%>
    <div class="newPopupRegister is-show" id="sign-up-with-social">
        <div class="newPopupRegister-content" >
            <div class="wao-modal-step-container">

                <section class="newPopupRegister-navigation">
                    <div class="sign-up-step-header"><img src="/template/front-end-new/img/login_register/logo-step.png"
                            alt="" />
                        <h3 id="step-header" class="step-header">Đăng ký - Bước 1</h3>
                    </div>
                    <nav id="progressSignUpSocial">
                        <ul>
                            <li class="is-active"><span>1</span>
                                <p>Cập nhật tài khoản</p>
                            </li>
                            <li><span>2</span>
                                <p>Chọn giới tính</p>
                            </li>
                            <li><span>3</span>
                                <p>Cập nhật hồ sơ</p>
                            </li>
                            <li><span>4</span>
                                <p>Hoàn tất cập nhật</p>
                            </li>
                        </ul>
                    </nav>
                </section>
                <!-- Insert Step here-->
                <form  method="" action="" class="newPopupRegister-modal-content">
                    <section class="registerNew-step is-active" >
                        <input type="button" id="btn-trigger-update-socical-step-1-success" hidden>
                        <h2 class="registerNew-step-title">Chỉ cần vài bước cập nhật tài khoản, <br> hành trình
                            tìm kiếm chân ái sẽ bắt đầu ngay thôi</h2>
                            <div class="registerNew-step-content">
                                <div class="step-form-item">
                                    <label class="label_step1">Username (Tên đăng nhập)</label>
                                    <input class="step-form-input" id="usernameFormSocial" name="userName" type="text" />
                                    <span class="step-form-error-message">Có lỗi xảy ra</span>
                                </div>
                                <div class="step-form-item">
                                    <label class="label_step1">Email</label>
                                    <input class="step-form-input" id="emailFormSocial" type="email"
                                    <% console.log(socialInfo.email) %> 
                                    <%if(socialInfo && socialInfo.email && socialInfo.email != '129812481239123912741374184913018123'){%>
                                    value="<%=socialInfo.email%>" <%}%>
                                        <%if(socialInfo){%>
                                    <%if(socialInfo.email && socialInfo.email.length > 0 && socialInfo.email != '129812481239123912741374184913018123'){%>
                                    disabled <%}%>
                                        <%}%> />
                                <span class="wao-form-error-message">Có lỗi xảy ra</span>
                                </div>
                                <div class="step-form-action" style="align-items: stretch;">
                                    <span class="btn-cancel-step" id="btn-cancel-social" data-link = '/home'>Huỷ</span>
                                    <span class="btn-next-step">Tiếp theo</span>
                                </div>
                            </div>
                    </section>

                    <section class="registerNew-step"  >
                        <input type="button" id="btn-trigger-update-socical-step-2-success" hidden>
                        <h2 class="registerNew-step-title">Người quan trọng ơi!<b>Bạn là ...</b></h2>
                        <div class="registerNew-step-content">
                            <div class="step-item-select">
                                <input class="step-input-select male" type="radio" name="genderSocial" id="maleSocial"
                                    checked value="1">
                                <label class="step-label-select check-box-male" for="maleSocial" id="check-box-male-social">
                                    <figure class="check-box-gender"></figure>
                                    <figcaption style="font-size: 18px;">Nam</figcaption>
                                </label>
                                <input class="step-input-select female" type="radio" name="genderSocial" id="femaleSocial"
                                    value="0">
                                <label class="step-label-select check-box-female" for="femaleSocial"
                                    id="check-box-female-social">
                                    <figure class="check-box-gender"></figure>
                                    <figcaption style="font-size: 18px;">Nữ</figcaption>
                                </label>
                            </div>
                            <div class="step-form-action" style="align-items: stretch;">
                                <span class="btn-cancel-step" id="btn-cancel-social" data-link = '/home'>Huỷ</span>
                                <span class="btn-next-step" id="update-social-gender-step">Tiếp theo</span>
                            </div>
                        </div>
                    </section>

                    <section class="registerNew-step" >
                        <input type="button" id="btn-trigger-update-socical-step-3-success" hidden>
                        <h2 class="registerNew-step-title">Bạn sẽ được rất nhiều người ái mộ, <br> thêm thông tin
                            để kết nối với họ tốt hơn</b></h2>
                        <div class="registerNew-step-content">
                            <div class="step-form-selects">
                                <div class="step-form-item">
                                    <label>Ngày</label>
                                    <div class="step-wrapper-select">
                                        <select class="step-form-input wao-form-select" id="dayFormSocial" name="dayOfBirth"
                                            required="required">
                                            <option>01</option>
                                            <option>02</option>
                                            <option>03</option>
                                            <option>04</option>
                                            <option>05</option>
                                            <option>06</option>
                                            <option>07</option>
                                            <option>08</option>
                                            <option>09</option>
                                            <option>10</option>
                                            <option>11</option>
                                            <option>12</option>
                                            <option>13</option>
                                            <option>14</option>
                                            <option>15</option>
                                            <option>16</option>
                                            <option>17</option>
                                            <option>18</option>
                                            <option>19</option>
                                            <option>20</option>
                                            <option>21</option>
                                            <option>22</option>
                                            <option>23</option>
                                            <option>24</option>
                                            <option>25</option>
                                            <option>26</option>
                                            <option>27</option>
                                            <option>28</option>
                                            <option>29</option>
                                            <option>30</option>
                                            <option>31</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="step-form-item has-label is-required">
                                    <label>Tháng</label>
                                    <div class="step-wrapper-select">
                                        <select class="step-form-input wao-form-select" name="monthOfBirth" id="monthFormSocial"
                                            required="required">
                                            <option>01</option>
                                            <option>02</option>
                                            <option>03</option>
                                            <option>04</option>
                                            <option>05</option>
                                            <option>06</option>
                                            <option>07</option>
                                            <option>08</option>
                                            <option>09</option>
                                            <option>10</option>
                                            <option>11</option>
                                            <option>12</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="step-form-item has-label is-required">
                                    <label>Năm</label>
                                    <div class="step-wrapper-select">
                                        <select class="step-form-input wao-form-select" name="yearOfBirth" id="yearFormSocial"
                                            required="required">
                                            <option class="female-only">2002</option>
                                            <option class="female-only">2001</option>
                                            <option class="female-only">2000</option>
                                            <option class="female-only">1999</option>
                                            <option class="female-only">1998</option>
                                            <option class="female-only">1997</option>
                                            <option>1996</option>
                                            <option>1995</option>
                                            <option>1994</option>
                                            <option>1993</option>
                                            <option>1992</option>
                                            <option>1991</option>
                                            <option>1990</option>
                                            <option>1989</option>
                                            <option>1988</option>
                                            <option>1987</option>
                                            <option>1986</option>
                                            <option>1985</option>
                                            <option>1984</option>
                                            <option>1983</option>
                                            <option>1982</option>
                                            <option>1981</option>
                                            <option>1980</option>
                                            <option>1979</option>
                                            <option>1978</option>
                                            <option>1977</option>
                                            <option>1976</option>
                                            <option>1975</option>
                                            <option>1974</option>
                                            <option>1973</option>
                                            <option>1972</option>
                                            <option>1971</option>
                                            <option>1970</option>
                                            <option>1969</option>
                                            <option>1968</option>
                                            <option>1967</option>
                                            <option>1966</option>
                                            <option>1965</option>
                                            <option>1964</option>
                                            <option>1963</option>
                                            <option>1962</option>
                                            <option>1961</option>
                                            <option>1960</option>
                                            <option>1959</option>
                                            <option>1958</option>
                                            <option>1957</option>
                                            <option>1956</option>
                                            <option>1955</option>
                                            <option>1954</option>
                                            <option>1953</option>
                                            <option>1952</option>
                                            <option>1951</option>
                                            <option>1950</option>
                                            <option>1949</option>
                                            <option>1948</option>
                                            <option>1947</option>
                                            <option>1946</option>
                                            <option>1945</option>
                                            <option>1944</option>
                                            <option>1943</option>
                                            <option>1942</option>
                                            <option>1941</option>
                                            <option>1940</option>
                                        </select>
                                    </div>
                                </div>
                                <span class="wao-form-error-message date">Ngày tháng không hợp lệ </span>
                            </div>
                            <div class="wao-form-number">
                                <label class="wao-form-number-label">Cập nhật số điện thoại để bảo mật tài khoản tốt
                                    hơn</label>
                                <div class="step-form-number-container">
                                    <div class="step-form-item-phone">
                                        <input class="step-form-input wao-form-input-number"  type="text" value="+84" />
                                        <span class="wao-form-error-message">Có lỗi xảy ra</span>
                                    </div>
                                    <div class="step-form-item-phone">
                                        <input class="step-form-input wao-form-input-number" name="userPhone" id="phoneFormSocial"
                                            type="number" value="" /><span class="wao-form-error-message">Sai định dạng số điện thoại</span>
                                    </div>
                                </div>
                            </div>
                            <div class="step-form-item has-label is-required wao-form-item-city">
                                <label>Nhà bạn ở đâu thế?</label>
                                <div class="wao-wrapper-select city-select">
                                    <select class="step-form-input wao-form-select" name="address" id="cityFormSocial" required="required">
                                        <option value="-1">Chọn tỉnh/thành phố</option>
                                        <%for(let index in provinces) {%>
                                        <option value="<%=provinces[index].code && provinces[index].code%>">
                                            <%=provinces[index].name && provinces[index].name%></option>
                                        <%}%>
                                    </select>
                                    <span class="wao-form-error-message errorAddress">Vui lòng chọn nơi bạn sống</span>
                                </div>
                            </div>
                            <div class="step-form-action" style="align-items: stretch;">
                                <span class="btn-cancel-step" id="btn-cancel-social" data-link = '/home'>Huỷ</span>
                                <span class="btn-next-step" >Tiếp theo</span>
                            </div>
                        </div>
                    </section>

                    <section class="registerNew-step" >
                        <input type="button" id="btn-trigger-update-socical-step-4-success" hidden>
                        <h2 class="registerNew-step-title">Đến lúc tỏa sáng rồi đây!<br> Chọn ảnh bạn yêu thích</b></h2>
                        <div class="registerNew-step-content">
                            <div class="wao-step__content">
                                <input type="file" id="avatarFormSocial" name="avtUser" class="form-img" accept="image/png,image/jpeg">
                                <img id="avatarFormImgSocial" src="" style="position: absolute;visibility: hidden;" alt="">
                                <div class="block-avatar" id="btn-avatar-form-social">   
                                    <label class="block-avatar__img" for="avatarFormSocial">
                                        <span class="block-avatar__btn"></span>
                                    </label>    
                                </div>
                                <span class="wao-form-error-message">Vui lòng upload avatar</span>
                            </div>
                            <div class="step-form-action" style="align-items: stretch;">
                                <span class="btn-cancel-step" id="btn-cancel-social" data-link = '/home'>Huỷ</span>
                                <input type="submit" id="submit_form" value="Hoàn tất đăng ký" ></input>
                            </div>
                        </div>
                    </section>
                </form>  
            </div>
        </div>
        <div class="newPopupRegister-overlay">
        </div>
</div>

<script>        
    $(document).ready(function () {

        let count = 1;
        let listFormPopup = $('.registerNew-step');
        let btnNextStep = $('.btn-next-step');
        let listMenu = $('#progressSignUpSocial ul li');
        let user = {}
        /*
        * TRIGGER FORM REGISTER CHO ANH ĐẠT 09
        */
        let form1 = document.querySelector('#btn-trigger-update-socical-step-1-success')
        let form2 = document.querySelector('#btn-trigger-update-socical-step-2-success')
        let form3 = document.querySelector('#btn-trigger-update-socical-step-3-success')
        let form4 = document.querySelector('#btn-trigger-update-socical-step-4-success')
        
        function hiddenAllForm () {
            listFormPopup.each(function (i, e) {
                $(e).removeClass('is-active')
            })
            listMenu.each(function (i, e) {
                $(e).removeClass('is-active')
            })
        }

        function activeClassForm (index){
            hiddenAllForm();
            $(listFormPopup[index]).addClass('is-active');
            $(listMenu[index]).addClass('is-active');
        }

        function nextForm(count) {
            switch (count) {
                case 1:
                    activeClassForm(count);
                    step_01()
                    break;
                case 2:
                    activeClassForm(count);
                    step_02()
                    break;
                case 3:
                    activeClassForm(count);
                    step_03()
                    break;
                default:
                    break;
            }
        }

        function step_01() {
            $(btnNextStep[1]).click(()=> {
                user.gender = $('input[name="genderSocial"]:checked').val();
                form2.click()
                count++
                nextForm(count);
            });
        }

        function step_02() {
            $(btnNextStep[2]).click(()=> {
                let day = $('select[name="dayOfBirth"]').val();
                let month = $('select[name="monthOfBirth"]').val();
                let year = $('select[name="yearOfBirth"]').val();

                checkPhone('#phoneFormSocial').then( res => {
                    if(res.status == true) {
                        user.phone = res.phone
                        if(checkDate(day, month, year) == true) {
                            user.birthday = day+month+year
                            if(checkProvince('cityFormSocial')){
                                form3.click()
                                count++
                                nextForm(count)
                            }
                        }
                    }
                });
            });
        }

        const getFormRegisterSocial = () => {
            const username = $('#usernameFormSocial').val();
            const email = $('#emailFormSocial').val().toLowerCase();
            const gender = $("input[name=genderSocial]:checked").val();
            const age = caculatorAge($('select[name="dayOfBirth"]').val(), $('select[name="monthOfBirth"]').val(), $('select[name="yearOfBirth"]').val());
            const phone = $('#phoneFormSocial').val();
            const province = $('#cityFormSocial').val();
           
            return { username  , email, gender, age, phone, province};
        };

        function step_03() {
            $('#submit_form').click(function (e) { 
                e.preventDefault();
                checkAvatar('#avatarFormImgSocial').then(() => {
                    let data = getFormRegisterSocial();
                    var avatarVal = $('#avatarFormImgSocial').attr('src');
                    var blob = base64ToBlob(avatarVal, 'image/jpeg');
                    var fd = new FormData();
                    fd.append('avatar', blob);
                    fd.append('data', JSON.stringify(data));
                    $.ajax({
                        url: `/cap-nhat-thong-tin-social`,
                        method: 'POST',
                        data: fd,
                        processData: false,
                        contentType: false,
                        success: function (resp) {
                            if (resp.error) {
                                openPopup('#wao-modal-sign-up-fail .wao-modal-content');
                            } else {
                                openPopup('#wao-modal-sign-up-success-social .wao-modal-content');
                                $('#btn-trigger-update-socical-step-4-success').trigger('click');
                                $('.wao-popup__btn-refuse').trigger('click');
                                    
                                    <% if (signUpFrom === 'facebook') { %>
                                        $('#facebook123').trigger('click');
                                        console.log('đăng ký = facebook')
                                    <% } else if (signUpFrom === 'google') { %>
                                        console.log('đăng ký = google')
                                        $('#google123').trigger('click');
                                    <% } %>
                                    setTimeout(function () {
                                        return window.location.href = '/ca-nhan/cap-nhat-thong-tin';
                                    }, 1000);
                            }

                        },
                        error: function (err) {
                            return toastr['warning']('Đăng ký không thành công, xin vui lòng bấm lại', 'Thông Báo');
                        }
                    });
                });
            });
        }

        $(btnNextStep[0]).click(()=> {
            const username = $('#usernameFormSocial').val();
            if(username !== '') {
                if(username.length < 8) {
                    setErrorMessage($('#usernameFormSocial'), "Tên đăng nhập phải trên 8 ký tự!")
                }else {
                    $.ajax({
                        url : `/checkUserNameRegister/${username}`,
                        type : 'GET',
                        success : function (res) {
                            if(res.status == true) {
                                $('#usernameFormSocial').removeClass("is-error");
                                checkMail($('#emailFormSocial'), `/check-mail-social-existenced`).then(() => {
                                    $('#emailFormSocial').removeClass("is-error");
                                    user.username = username;
                                    form1.click()
                                    nextForm(count);    
                                });
                            }else {
                                setErrorMessage($('#usernameFormSocial'), "Tên đăng nhập đã được sử dụng!");
                            }
                        },
                        error : function (err) {  
                            console.log(err)
                        }
                    })
                }
            }else{
                setErrorMessage($('#usernameFormSocial'), "Tên đăng nhập không được để trống!");
            }
           
        });

        /* [DUC ANH] 1:13 AM check user age (male >= 22 years old) */
         document.querySelector('#update-social-gender-step').addEventListener('click', (e) => {
             if (document.querySelector('#maleSocial').checked) {
                document.querySelectorAll('.female-only').forEach(e => e.remove())
            }
        })
        /* [DUC ANH] 1:13 AM end check user age (male >= 22 years old) */
        

        // [DUC ANH] cancel reigster -> logout 1:59 PM
        document.querySelectorAll('.btn-cancel-step').forEach(e => e.addEventListener('click', (e) => {
            swal({
                title: "Huỷ đăng ký",
                text: "bạn có chắc chắn muốn huỷ đăng ký ?",
                icon: "warning",
                showCancelButton: true,
                showConfirmButton: true,
                cancelButtonText: "Không",
                confirmButtonText: "Chắc chắn",
            }, function () {
                window.location.href = '/clear-session'
            });
        }))
        /* oke --------------------------------*/

        ResizeUploads('#avatarFormSocial', '#popup-avatar');

        $('#usernameFormSocial').keyup(function () {
            let val = $(this).val();
            let valConvert = removeUtf8AndJoinSpace(val);
            $(this).val(valConvert);
        })
       
        var avatar = {
            name: 'avatar',
            viewport: {
                width: 300,
                height: 300,
            },
            result: {
                width: 350,
                height: 350,
            },
            boundary: {
                width: 300,
                height: 300
            },
            notifications: {
                success: 'Cập Nhật Ảnh Thành Công',
                error: 'Lỗi Upload Ảnh'
            }
        }
        CropImage.init(
            '#avatarFormSocial',
            '#btn-avatar-form-social label',
            '#avatarFormImgSocial',
            avatar
        );
        openPopup('#sign-up-with-social .wao-modal-content');
        // const getFormRegisterSocial = () => {
        //     const email = $('#emailFormSocial').val().toLowerCase();
        //     const age = caculatorAge($('#dayFormSocial').val(), $('#monthFormSocial').val(), $('#yearFormSocial').val());
        //     const province = $('#cityFormSocial').val();
        //     const gender = $("input[name=genderSocial]:checked").val();
        //     const username = $('#usernameFormSocial').val();
        //     const phone = $('#phoneFormSocial').val();

        //     return { gender, email, age, username, province, phone };
        // };

        // const stepNavigation = "#progressSignUpSocial ul li";
        // let currentSection = $(stepNavigation).parents('.newPopupRegister-navigation').siblings('.wao-sign-up-step-modal-content').find('section.wao-sign-up-step');

        // $("#sign-up-with-social .wao-button-next").click(async function () {

        //     current_fs = $(this).parents("form.wao-sign-up-step");
        //     if (counter === 1) {
        //         checkUserName('usernameFormSocial').then(() => {
        //             checkMail($('#emailFormSocial'), `/check-mail-social-existenced`).then(() => {
        //                 $('#emailFormSocial').removeClass("is-error");
        //                 $('#btn-trigger-update-socical-step-1-success').trigger('click');
        //                 onNext(current_fs, stepNavigation, currentSection);
        //             });
        //         });
        //     } else if (counter === 2) {
        //         $('#btn-trigger-update-socical-step-2-success').trigger('click')
        //         onNext(current_fs, stepNavigation, currentSection);
        //     } else if (counter === 3) {
        //         checkPhone('#phoneFormSocial').then(() => {
        //             checkDate($('#dayFormSocial').val(), $('#monthFormSocial').val(), $('#yearFormSocial').val()) && checkProvince('cityFormSocial') && $('#btn-trigger-update-socical-step-3-success').trigger('click') && onNext(current_fs, stepNavigation, currentSection);
        //         });
        //     } else {
        //         return;
        //     }

        // });
        
        $('#btn-update-social').on('click', function (e) {
            checkAvatar('#avatarFormImgSocial').then(() => {
                let data = getFormRegisterSocial();
                var avatarVal = $('#avatarFormImgSocial').attr('src');
                var blob = base64ToBlob(avatarVal, 'image/jpeg');
                var fd = new FormData();
                fd.append('avatar', blob);
                fd.append('data', JSON.stringify(data));
                $.ajax({
                    url: `/cap-nhat-thong-tin-social`,
                    method: 'POST',
                    data: fd,
                    processData: false,
                    contentType: false,
                    success: function (resp) {
                        if (resp.error) {
                            openPopup('#wao-modal-sign-up-fail .wao-modal-content');
                        } else {
                            openPopup('#wao-modal-sign-up-success-social .wao-modal-content');
                            $('.wao-popup__btn-refuse').trigger('click');
                                
                                <% if (signUpFrom === 'facebook') { %>
                                    $('#facebook123').trigger('click');
                                    console.log('đăng ký = facebook')
                                <% } else if (signUpFrom === 'google') { %>
                                    console.log('đăng ký = google')
                                    $('#google123').trigger('click');
                                <% } %>
                                setTimeout(function () {
                                    return window.location.href = '/ca-nhan/cap-nhat-thong-tin';
                                }, 1000);
                        }

                    },
                    error: function (err) {
                        return toastr['warning']('Đăng ký không thành công, xin vui lòng bấm lại', 'Thông Báo');
                    }
                });
            });

        })

        $('.likeGuest').on('click', function (e) {
            e.preventDefault();
            console.log('fucking out')
            let token = localStorage.getItem('token_waodate');
            if (!token) {
                alert('Vui Lòng Đăng Nhập');
                return window.location.href = '/dang-nhap'
            }
            $popup_id = $(this).attr('data')
            let guestID = $(this).attr('_guestID');

            // [Minh] 10:59AM 23/05/2020
            let likeGuest = this;

            if ($(this).hasClass('active')) {
                // return  toastr['error']('Bạn đã thích người này', 'Thông Báo');
                $.ajax({
                    url: `/ca-nhan/unlike-user-guest/${guestID}`,
                    method: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer ' + token);
                    },
                    success: function (resp) {
                        if (resp.error) {
                            if (resp.message === `redirect_url_clear_session`)
                                return window.location.href = '/clear-session';
                            return swal("Yêu Thích Thất Bại", " ", "error");
                        }
                        socket.emit('USER_UNLIKE_USER_CSS', {
                            receiverID: guestID
                        });

                        // [Minh] 10:51AM 23/05/2020
                        $(likeGuest).closest('.right-top-card').find('.likeGuest').removeClass('active');
                        // [Minh] 4:07PM 26/05/2020
                        let li = $(likeGuest).closest('.right-top-card').find('ul.meta > li:nth-child(2)');
                        let new_favorite = Number(li.text().trim()) - 1 || 0;
                        new_favorite < 0 && (new_favorite = 0);
                        li.contents().filter(function () {
                            return this.nodeType === 3
                        })[1].textContent = new_favorite;

                        // [Minh] 4:30PM 5/6/2020
                        //return $('#' + $popup_id).find('span').html('Bỏ Yêu Thích Thành Công', 'Thông Báo')
                        $('body').addClass('of-hidden');
                        return $('#' + $popup_id).addClass('active').find('span').html('Bỏ Yêu Thích Thành Công', 'Thông Báo')
                    },
                    error: function (err) {
                        console.log(err.message);
                    }
                })
            } else {
                $.ajax({
                    url: `/ca-nhan/like-user-guest/${guestID}`,
                    method: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer ' + token);
                    },
                    success: function (resp) {
                        if (resp.error) {
                            if (resp.message === `redirect_url_clear_session`)
                                return window.location.href = '/clear-session';
                            return swal("Yêu Thích Thất Bại", " ", "error");
                        }

                        conosle.log('Thành công rồi nè')
                        socket.emit('USER_LIKE_USER_CSS', {
                            receiverID: guestID
                        });

                        // [Minh] 10:51AM 23/05/2020
                        $(likeGuest).closest('.right-top-card').find('.likeGuest').addClass('active');
                        // [Minh] 4:07PM 26/05/2020
                        let li = $(likeGuest).closest('.right-top-card').find('ul.meta > li:nth-child(2)');
                        let new_favorite = Number(li.text().trim()) + 1 || '';
                        li.contents().filter(function () {
                            return this.nodeType === 3
                        })[1].textContent = new_favorite;

                        // [Minh] 4:30PM 5/6/2020
                        // return $('#' + $popup_id).find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                        $('body').addClass('of-hidden');
                        return $('#' + $popup_id).addClass('active').find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                    },
                    error: function (err) {
                        console.log(err.message);
                    }
                })
            }
        });
        $('.likeConcept').on('click', function (e) {
            e.preventDefault();
            $popup_id = $(this).attr('data')

            // [Minh] 6:39PM 25/05/2020
            const likeConcept = this;

            let token = localStorage.getItem('token_waodate');
            if (!token) {
                swal("Có lỗi xảy ra", "Vui Lòng Đăng Nhập", "error");
                return window.location.href = '/dang-nhap'
            }

            let conceptID = $(this).attr('_conceptID');
            if ($(`.ele_change_color_like_concept_${conceptID}`).hasClass('fa-heart')) {
                // [Minh] 10:34AM 25/05/2020
                // Dont have route for unlike concept ???

                // [Minh] 4:32 PM 5/6/2020
                // return $('#' + $popup_id).find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                $('body').addClass('of-hidden');
                return $('#' + $popup_id).addClass('active').find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                // return toastr['error']('Concept này đã tồn tại trong danh sách yêu thích của bạn', 'Thông Báo');
            }

            $.ajax({
                url: `/ca-nhan/like-concept/${conceptID}`,
                method: 'GET',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", 'Bearer ' + token);
                },
                success: function (resp) {
                    if (resp.error) {
                        if (resp.message === `redirect_url_clear_session`)
                            return window.location.href = '/clear-session';
                        if (resp.message === `concept_liked`) {
                            // [Minh] 6:33PM 25/05/2020 Comment below line
                            //$('.wao-like-btn').addClass('active');

                            // [Minh] 4:33PM 5/6/2020
                            // return $('#' + $popup_id).find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                            $('body').addClass('of-hidden');
                            return $('#' + $popup_id).addClass('active').find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                            // return toastr['error']('Concept này đã tồn tại trong danh sách yêu thích của bạn!');
                        }
                        return swal("Yêu Thích Thất Bại", " ", "error");
                    } else if (!resp.error) {
                        socket.emit('USER_LIKE_CONCEPT_CSS', {
                            conceptID
                        });
                        // $(`.ele_change_color_like_concept_${conceptID}`).removeClass('fa-heart-o');
                        // $(`.ele_change_color_like_concept_${conceptID}`).addClass('fa-heart');

                        // [Minh] 6:41PM 25/05/2020
                        $(likeConcept).addClass('active');
                        // [Minh] 3:40PM 26/05/2020 - increase liked-number
                        let li = $(likeConcept).closest('.right-top-card').find('ul.meta > li:nth-child(2)');
                        let new_favorite = Number(li.text().trim()) + 1 || '';
                        li.contents().filter(function () {
                            return this.nodeType === 3
                        })[1].textContent = new_favorite;

                        // [Minh] 6:41PM 25/05/2020 - Comment line below
                        //$('.wao-like-btn').addClass('active');

                        // [Minh] 4:34PM 5/6/2020
                        // return $('#' + $popup_id).find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                        $('body').addClass('of-hidden');
                        return $('#' + $popup_id).addClass('active').find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                        // return toastr['success']('Đã lưu vào danh sách yêu thích', 'Thông Báo');
                    }
                },
                error: function (err) {
                    console.log(err.message)
                }
            })
        });

        $('.requestParticipantion').on('click', function (e) {
            e.preventDefault();
            let conceptID = $(this).attr('_conceptID');
            let authorID = $(this).attr('_authorID');

            $('.confirmRequestParticipantion').attr('_conceptID', conceptID);
            $('.confirmRequestParticipantion').attr('_authorID', authorID);
            // [Minh] 4:44PM 5/6/2020
            $('body').addClass('of-hidden');
            let id = '#' + $(this).attr('data');
            return $(id).addClass('active');
            //return $('#requestParticipantion').addClass('wao-popup--open');
        });


        function clearInputRequestParticipantion() {
            $('#txtMessageRequestParticipantion').val('');
            // $('#txtPrayerRequestParticipantion').val('');
            // [Minh] 9:06AM 25/05/2020
            $('#txtPrayerRequestParticipantion input[name=chi-phi]:checked').prop('checked', false);

            // AN fix !!!
            /* $('#txtPrayerRequestParticipantion').val('');
            $('input[name=chi-phi]:checked', '#txtPrayerRequestParticipantion').prop('checked', false); */
        }

        $('.confirmRequestParticipantion').on('click', function (e) {
            e.preventDefault();

            let token = localStorage.getItem('token_waodate');
            if (!token) {
                alert('Vui Lòng Đăng Nhập');
                return window.location.href = '/dang-nhap'
            }

            let guestID = $(this).attr('_guestID');
            if ($(`.ele_change_color_like_guest_${guestID}`).hasClass('fa-heart')) {
                // return  alert('Error', 'Bạn Đã Thích Người Này', 'Thông Báo'));
                $.ajax({
                    url: `/ca-nhan/unlike-user-guest/${guestID}`,
                    method: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer ' + token);
                    },
                    success: function (resp) {
                        if (resp.error) {
                            if (resp.message === `redirect_url_clear_session`)
                                return window.location.href = '/clear-session';
                            return alert('Error', 'Yêu Thích Thất Bại', 'Thông Báo');
                        }
                        socket.emit('USER_UNLIKE_USER_CSS', {
                            receiverID: guestID
                        });
                        $(`.ele_change_color_like_guest_${guestID}`).removeClass('fa-heart');
                        $(`.ele_change_color_like_guest_${guestID}`).addClass('fa-heart-o');

                        return alert('Error', 'Bỏ Yêu Thích Thành Công', 'Thông Báo');
                    },
                    error: function (err) {
                        console.log(err.message);
                    }
                })
            } else {
                $.ajax({
                    url: `/ca-nhan/like-user-guest/${guestID}`,
                    method: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer ' + token);
                    },
                    success: function (resp) {
                        if (resp.error) {
                            if (resp.message === `redirect_url_clear_session`)
                                return window.location.href = '/clear-session';
                            return alert('Error', 'Yêu Thích Thất Bại', 'Thông Báo');
                        }

                        console.log('Thành công kiểu này ! ')
                        socket.emit('USER_LIKE_USER_CSS', {
                            receiverID: guestID
                        });
                        $(`.ele_change_color_like_guest_${guestID}`).removeClass('fa-heart-o');
                        $(`.ele_change_color_like_guest_${guestID}`).addClass('fa-heart');

                        return alert('Error', 'Dã', 'Thông Báo');
                    },
                    error: function (err) {
                        console.log(err.message);
                    }
                })
            }
        });

    })

</script>

<%}%>


<div class="wao-popup" id="wao-favorite-popup">
    <div class="wao-popup-bg"></div>
    <div class="wao-popup-container">
        <p><img src="/template/front-end-new/img/date-detail/check_icon.svg"
                alt=""><span>Đã lưu vào danh sách yêu thích</span></p>
    </div>
</div>
<!-- popup -->
<div class="wao-popup" id="wao-enjoy-date-popup">
    <div class="wao-popup-bg"></div>
    <div class="wao-popup-container">
        <h3>Bạn xác nhận đồng ý tham dự <br> cuộc hẹn này chứ?</h3>
        <form action="" id="txtPrayerRequestParticipantion">
            <textarea name="" id="txtMessageRequestParticipantion" 
                placeholder="Để lại lời nhắn cho người tổ chức hoặc bỏ qua ..."></textarea>
            <p>Thỏa thuận về mức chi phí bạn trả</p>
            <p>
                <!-- <label for="thuong-luong" class="wao-radio-btn">
<input type="radio" name="chi-phi" id="thuong-luong" value="thuong-luong">
<span>Thương lượng</span>
</label> -->
                <%prayers && prayers.length > 0 && prayers.forEach(prayer => {%>
                <label class="wao-radio-btn">
                    <input type="radio" name="chi-phi"
                        value="<%=prayer.value && prayer.value%>">
                    <span><%=prayer.text && prayer.text%></span>
                </label>
                <%})%>
            </p>
            <p style="display: flex;justify-content: center;">
                <a href="" class="wao-btn-transparent wao-close-popup">Không,<br>tôi
                    chưa sẵn sàng</a>
                <input type="submit" class="confirmRequestParticipantion"
                    _conceptId="" _authorID='' value="Có">
            </p>
        </form>
    </div>
</div>
<div id="tranformBtnSupport"></div>
<%if (!hrefCurrent.includes('/buoi-hen-ho')) {%>
<script>
        
    const getDataSearch = () => {
        let sort = $('#sort_concept').val();
        let prayer = $('#prayer_concept').val();
        let gender = $("input.gender_concept[name=gender]:checked").val();
        let fromAge = $('#fromAge_concept').val();
        let toAge = $('#toAge_concept').val();
        let province = $('#province_concept').val();
        let district = $('#district_concept').val();
        let key = $('#text_search').val();
        return { sort, prayer, gender, fromAge, toAge, province, district, key };
    }

    const buildURISearch = () => {
        const { sort, prayer, gender, fromAge, toAge, province, district, key } = getDataSearch();
        let uri = `/buoi-hen-ho?sort=${sort}`;

        if (!Number.isNaN(Number(prayer))) uri += `&prayer=${prayer}`;
        if (!Number.isNaN(Number(gender))) uri += `&gender=${gender}`;

        if (!Number.isNaN(Number(fromAge)) && !Number.isNaN(Number(toAge))) uri += `&fromAge=${fromAge}&toAge=${toAge}`;
        if (!Number.isNaN(Number(province)) && province) uri += `&province=${province}`;

        if (!Number.isNaN(Number(province)) && !Number.isNaN(Number(district))) uri += `&district=${district}`;

        if (key && key.length > 2)
            uri += `&key=${key}`;

        return window.location.href = uri;
    }
    $('.btnSearchNormal').on('click', function (e) {
        e.preventDefault();
        buildURISearch();
    })
</script>
<%}%>

<script>
    
        $('.likeGuest').on('click', function(e){
            e.preventDefault();
            console.log('fucking out')
            
            let token = localStorage.getItem('token_waodate');
            if (!token)
            {
                alert('Vui Lòng Đăng Nhập');
                return window.location.href = '/dang-nhap'
            }
            $popup_id = $(this).attr('data')
            let guestID = $(this).attr('_guestID');

            // [Minh] 10:59AM 23/05/2020
            let likeGuest = this;

            if($(this).hasClass('active')){
                // return  toastr['error']('Bạn đã thích người này', 'Thông Báo');
                $.ajax({
                    url: `/ca-nhan/unlike-user-guest/${guestID}`,
                    method: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer '+ token);
                    },
                    success: function(resp) {
                        if (resp.error) {
                            if (resp.message === `redirect_url_clear_session`) 
                                return window.location.href = '/clear-session';
                            return swal("Yêu Thích Thất Bại"," ", "error");   
                        }
                        socket.emit('USER_UNLIKE_USER_CSS', {
                            receiverID: guestID
                        });
                        $(likeGuest).removeClass('active')
                        // [Minh] 10:51AM 23/05/2020
                        $(likeGuest).closest('.right-top-card').find('.likeGuest').removeClass('active');
                        // [Minh] 4:07PM 26/05/2020
                        let li = $(likeGuest).closest('.right-top-card').find('ul.meta > li:nth-child(2)');
                        let new_favorite = Number(li.text().trim()) - 1 || 0;
                        new_favorite < 0 && (new_favorite = 0);
                        li.contents().filter(function() {
                            return this.nodeType === 3
                        })[1].textContent = new_favorite;

                        // [Minh] 4:30PM 5/6/2020
                        //return $('#' + $popup_id).find('span').html('Bỏ Yêu Thích Thành Công', 'Thông Báo')
                        $('body').addClass('of-hidden');
                        return $('#' + $popup_id).addClass('active').find('span').html('Bỏ Yêu Thích Thành Công', 'Thông Báo')
                    },
                    error: function(err){
                        console.log(err.message);
                    }
                })
            }else{
                $.ajax({
                    url: `/ca-nhan/like-user-guest/${guestID}`,
                    method: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer '+ token);
                    },
                    success: function(resp) {
                        if (resp.error) {
                            if (resp.message === `redirect_url_clear_session`) 
                                return window.location.href = '/clear-session';
                            return swal("Yêu Thích Thất Bại"," ", "error");   
                        }

                        console.log({guestID})
                        socket.emit('USER_LIKE_USER_CSS', {
                            receiverID: guestID
                        });
                        $(likeGuest).addClass('active')
                        // [Minh] 10:51AM 23/05/2020
                        $(likeGuest).closest('.right-top-card').find('.likeGuest').addClass('active');
                        // [Minh] 4:07PM 26/05/2020
                        let li = $(likeGuest).closest('.right-top-card').find('ul.meta > li:nth-child(2)');
                        let new_favorite = Number(li.text().trim()) + 1 || '';
                        li.contents().filter(function() {
                            return this.nodeType === 3
                        })[1].textContent = new_favorite;

                        // [Minh] 4:30PM 5/6/2020
                        // return $('#' + $popup_id).find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                        $('body').addClass('of-hidden');
                        return $('#' + $popup_id).addClass('active').find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                    },
                    error: function(err){
                        console.log(err.message);
                    }
                })
            }
        });
        $('.likeConcept').on('click', function(e){
            e.preventDefault();
            $popup_id = $(this).attr('data')

            // [Minh] 6:39PM 25/05/2020
            const likeConcept = this;

            let token = localStorage.getItem('token_waodate');
            if (!token)
            {
                swal("Có lỗi xảy ra","Vui Lòng Đăng Nhập", "error");
                return window.location.href = '/dang-nhap'
            }

            let conceptID = $(this).attr('_conceptID');
            if($(`.ele_change_color_like_concept_${conceptID}`).hasClass('fa-heart')) {
                // [Minh] 10:34AM 25/05/2020
                // Dont have route for unlike concept ???
                
                // [Minh] 4:32 PM 5/6/2020
                // return $('#' + $popup_id).find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                $('body').addClass('of-hidden');
                return $('#' + $popup_id).addClass('active').find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                // return toastr['error']('Concept này đã tồn tại trong danh sách yêu thích của bạn', 'Thông Báo');
            }

            $.ajax({
                url: `/ca-nhan/like-concept/${conceptID}`,
                method: 'GET',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", 'Bearer '+ token);
                },
                success: function(resp) {
                    if (resp.error) {
                        if (resp.message === `redirect_url_clear_session`) 
                            return window.location.href = '/clear-session';
                        if (resp.message === `concept_liked`) {
                            // [Minh] 6:33PM 25/05/2020 Comment below line
                            //$('.wao-like-btn').addClass('active');

                            // [Minh] 4:33PM 5/6/2020
                            // return $('#' + $popup_id).find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                            $('body').addClass('of-hidden');
                            return $('#' + $popup_id).addClass('active').find('span').html('Concept này đã tồn tại trong danh sách yêu thích của bạn!')
                            // return toastr['error']('Concept này đã tồn tại trong danh sách yêu thích của bạn!');
                        }
                        return swal("Yêu Thích Thất Bại"," ", "error");    
                    } else if (!resp.error){
                        socket.emit('USER_LIKE_CONCEPT_CSS', {
                            conceptID
                        });
                        // $(`.ele_change_color_like_concept_${conceptID}`).removeClass('fa-heart-o');
                        // $(`.ele_change_color_like_concept_${conceptID}`).addClass('fa-heart');
                        
                        // [Minh] 6:41PM 25/05/2020
                        $(likeConcept).addClass('active');
                        // [Minh] 3:40PM 26/05/2020 - increase liked-number
                        let li = $(likeConcept).closest('.right-top-card').find('ul.meta > li:nth-child(2)');
                        let new_favorite = Number(li.text().trim()) + 1 || '';
                        li.contents().filter(function() {
                            return this.nodeType === 3
                        })[1].textContent = new_favorite;

                        // [Minh] 6:41PM 25/05/2020 - Comment line below
                        //$('.wao-like-btn').addClass('active');

                        // [Minh] 4:34PM 5/6/2020
                        // return $('#' + $popup_id).find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                        $('body').addClass('of-hidden');
                        return $('#' + $popup_id).addClass('active').find('span').html('Đã lưu vào danh sách yêu thích', 'Thông Báo')
                        // return toastr['success']('Đã lưu vào danh sách yêu thích', 'Thông Báo');
                    }
                },
                error: function(err){
                    console.log(err.message)
                }
            })
        });

        $('.requestParticipantion').on('click', function(e){
            e.preventDefault();
            let conceptID = $(this).attr('_conceptID');
            let authorID  = $(this).attr('_authorID');

            $('.confirmRequestParticipantion').attr('_conceptID', conceptID);
            $('.confirmRequestParticipantion').attr('_authorID', authorID);
            // [Minh] 4:44PM 5/6/2020
            $('body').addClass('of-hidden');
            let id = '#' + $(this).attr('data');
            return $(id).addClass('active');
            //return $('#requestParticipantion').addClass('wao-popup--open');
        });


        function clearInputRequestParticipantion() {
            $('#txtMessageRequestParticipantion').val('');
            // $('#txtPrayerRequestParticipantion').val('');
            // [Minh] 9:06AM 25/05/2020
            $('#txtPrayerRequestParticipantion input[name=chi-phi]:checked').prop('checked', false);

            // AN fix !!!
            /* $('#txtPrayerRequestParticipantion').val('');
            $('input[name=chi-phi]:checked', '#txtPrayerRequestParticipantion').prop('checked', false); */
        }

        $('.requestParticipantion').on('click', function(e){
                e.preventDefault();
                let conceptID = $(this).attr('_conceptID');
                let authorID  = $(this).attr('_authorID');
    
                $('.confirmRequestParticipantion').attr('_conceptID', conceptID);
                $('.confirmRequestParticipantion').attr('_authorID', authorID);
                // [Minh] 4:44PM 5/6/2020
                $('body').addClass('of-hidden');
                let id = '#' + $(this).attr('data');
                return $(id).addClass('active');
                //return $('#requestParticipantion').addClass('wao-popup--open');
            });
    
    
            function clearInputRequestParticipantion() {
                $('#txtMessageRequestParticipantion').val('');
                // $('#txtPrayerRequestParticipantion').val('');
                // [Minh] 9:06AM 25/05/2020
                $('#txtPrayerRequestParticipantion input[name=chi-phi]:checked').prop('checked', false);
    
                // AN fix !!!
                /* $('#txtPrayerRequestParticipantion').val('');
                $('input[name=chi-phi]:checked', '#txtPrayerRequestParticipantion').prop('checked', false); */
            }

             //// regex các dấu cho string cần lọc từ khóa bị block
            const replace_sign = /[-!$%^&*()_+|~=`{}[:;<>?,.@#\]]/g ;
    
            $('.confirmRequestParticipantion').on('click', function(e){
                e.preventDefault();
                let that = this;
                let token = localStorage.getItem('token_waodate');
                if (!token)
                {
                    swal("Có lỗi xảy ra","Vui Lòng Đăng Nhập", "error");
                    return window.location.href = '/dang-nhap'
                }
                let conceptID = $(this).attr('_conceptID');
                let authorID = $(this).attr('_authorID');
    
                let message = $('#txtMessageRequestParticipantion').val();  
                let isNumber = checkphoneNumber(message);
                if(isNumber){
                    return toastr.warning(`Vui lòng không nhập số điện thoại`);
              }
              let arrBlockKey = <%- JSON.stringify(arrBlockKey)%>;
              if(containsBlockingKey(message.replace(replace_sign, " "), arrBlockKey)){
                return toastr.warning(`Lời nhắn của bạn có chứa từ khóa bị chặn vì vi phạm quy định sử dụng Waodate`);
              }
                // let prayer  = $('#txtPrayerRequestParticipantion').val();
                let prayer  = $('input[name=chi-phi]:checked', '#txtPrayerRequestParticipantion').val()
                /* if(!message) {
                    return swal("Có lỗi xảy ra","Vui lòng viêt lời nhắn", "error");
                } */
                if(!prayer) {
                    return swal("Có lỗi xảy ra","Vui lòng chọn mức chi phí bạn trả", "error");
                }
               
                const data = { conceptID, message, prayer };

                 /* [DUC ANH] tracking UTM */
                const isFromEmail = window.location.href.match(/utm_/g)

                if (isFromEmail && isFromEmail.length >= 1) {
                    let utms = window.location.href.split('utm_')
                    const campaign = utms.filter(e => e.match(/campaign/))
                    console.log(campaign)
                    if (campaign && campaign.length >= 1) {
                        const emailCampaign = campaign[0].replace(/campaign=/, '').replace(/(#|\?|&)/g, '')
                        console.log(emailCampaign)
                        data.emailCampaign = emailCampaign
                    }
                }
           
            $.ajax({
                url: `/ca-nhan/tham-gia`,
                method: 'POST',
                data: data,
                success: function(resp) {
                    if (resp.error) {
                        // [Minh] 8:52AM 25/05/2020
                        clearInputRequestParticipantion();
                        $('#wao-enjoy-date-popup').removeClass('active');
                        $('body, html').removeClass('of-hidden')
                        // ----

                        if (resp.message === "redirect_url_clear_session") 
                            return window.location.href = '/clear-session';
                        if(resp.message === "concept_not_valid_or_concept_closed") {
                            return swal("Gửi yêu cầu thất bại","Concept này đã đóng", "error");
                        }
                        if (resp.message === "user_accepted_this_concept") {
                            return swal("Gửi yêu cầu thất bại","Bạn Đã Gửi Yêu Cầu Tham Gia Concept này", "error");
                        }
                           
                        if (resp.message === "this_concept_enough_user") {
                            return swal("Gửi yêu cầu thất bại","Concept này đã đủ người tham gia", "error");
                        }

                        // [Minh] 8:52AM 25/05/2020
                        // clearInputRequestParticipantion();
                        return swal("Có lỗi xảy ra","Yêu Cầu Tham Gia Thất Bại!", "error");
                    } else if (!resp.error) {
                        swal("Chúc mừng bạn","Yêu Cầu Tham Gia Thành Công!", "success");
                        $('#wao-enjoy-date-popup').removeClass('active');

                        // [Minh] 9:47PM 22/05/2020
                        $('body, html').removeClass('of-hidden')
                        $('.requestParticipantion[_conceptid="' + conceptID + '"]').text('Đã tham gia').css({'pointer-events':'none','font-size':'12px'});
                        // [Minh] 9:58PM 22/05/2020 -- Inscrease number of register
                        let span_num_register = $('.requestParticipantion[_conceptid="' + conceptID + '"]').closest('.wao-date-card').find('.wao-label-yellow');
                        span_num_register.each(function() {
                            let old_register = $(this).text().trim().split(' ')[0];
                            let new_register = Number(old_register) + 1;
                            $(this).text(new_register + ' đăng ký')
                        })
                        //$('.requestParticipantion').text('Đã tham gia').css({'pointer-events':'none','font-size':'12px'});

                        // AN fix !!!
                        /* $('body, html').removeClass('of-hidden');
                        $(`a.wao-btn-join[_conceptID=${conceptID}]`).text('Đã tham gia');
                        $(`a.wao-btn-join[_conceptID=${conceptID}]`).removeClass('wao-popup-open requestParticipantion'); */
                        socket.emit('PARTICIPANT_REQUEST_CONCEPT_CSS', {    
                            conceptID, authorID
                        })
                        clearInputRequestParticipantion();
                        return $('.wao-popup__btn-refuse').trigger('click');
                    }
                },
                error: function(err){
                    clearInputRequestParticipantion();
                    // [Minh] 10:33AM 25/05/2020
                    $('#wao-enjoy-date-popup').removeClass('active');
                    // [Minh] 10:33AM 25/05/2020
                    $('body, html').removeClass('of-hidden')
                    return swal("Có lỗi xảy ra","Yêu Cầu Tham Gia Thất Bại!", "error");
                }
            }).done(function(){
                // clearInputRequestParticipantion();
            })
        })
</script>
